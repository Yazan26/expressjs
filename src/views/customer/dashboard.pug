extends ../layout

block content
  .container.mt-4
    .row
      .col-md-12
        h1.mb-4 Customer Dashboard
        if user
          h5.text-muted Welcome back, #{user.username} #{user.last_name}!
    
    .row
      // Active Rentals
      .col-md-8
        .card.mb-4
          .card-header
            .d-flex.justify-content-between.align-items-center
              h5.mb-0 Active Rentals
              span.badge.badge-primary= activeRentals ? activeRentals.length : 0
          .card-body
            if activeRentals && activeRentals.length > 0
              .table-responsive
                table.table.table-hover
                  thead
                    tr
                      th Movie
                      th Rented Date
                      th Due Date
                      th Daily Rate
                      th Status
                      th Action
                  tbody
                    each rental in activeRentals
                      tr(class=(rental.is_overdue ? 'table-danger' : ''))
                        td
                          strong= rental.title
                          br
                          small.text-muted= rental.category
                        td= new Date(rental.rental_date).toLocaleDateString()
                        td= new Date(rental.due_date).toLocaleDateString()
                        td $#{rental.rental_rate}
                        td
                          if rental.is_overdue
                            span.badge.badge-danger Overdue
                          else
                            span.badge.badge-success Active
                        td
                          a.btn.btn-sm.btn-outline-primary(href=`/customer/movies/${rental.film_id}`) View Details
              
              if summary.total_overdue > 0
                .alert.alert-warning.mt-3
                  strong #{summary.total_overdue} overdue rental(s)
                  p Please return these movies as soon as possible to avoid additional fees.
            else
              .text-center.py-4
                p.text-muted No active rentals
                a.btn.btn-primary(href='/customer/movies') Browse Movies
      
      // Summary and Quick Actions
      .col-md-4
        // Rental Summary
        .card.mb-4
          .card-header
            h5.mb-0 Rental Summary
          .card-body
            if summary
              .d-flex.justify-content-between
                span Total Active:
                strong= summary.total_active
              .d-flex.justify-content-between
                span Overdue:
                strong.text-danger= summary.total_overdue
              .d-flex.justify-content-between
                span This Month Cost:
                strong $#{summary.current_month_total.toFixed(2)}
              hr
              .d-flex.justify-content-between
                span Total Spent:
                strong.text-success $#{summary.total_spent.toFixed(2)}
        
        // Quick Actions
        .card.mb-4
          .card-header
            h5.mb-0 Quick Actions
          .card-body
            .d-grid.gap-2
              a.btn.btn-primary(href='/customer/movies') Browse Movies
              a.btn.btn-outline-secondary(href='/customer/spending') Spending History
              a.btn.btn-outline-info(href='/customer/profile') My Profile
              hr
              a.btn.btn-outline-danger(href='/auth/logout') Logout
