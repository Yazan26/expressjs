extends ../layout

block content
  section.mx-section.pt-0
    a.btn.btn-outline-light.btn-sm.rounded-pill.mb-3(href='/customer/dashboard')
      i.fas.fa-arrow-left.me-2
      | Back to dashboard
    .d-flex.flex-wrap.align-items-center.justify-content-between.mb-4
      div
        h1.h3.fw-semibold.mb-1
          i.fas.fa-user-circle.me-2.text-danger
          | My profile
        p.text-muted.mb-0 Manage your personal details and rental preferences.
      .btn-group
        a.btn.btn-outline-accent.rounded-pill(href='/customer/dashboard') Dashboard
        a.btn.btn-outline-light.rounded-pill(href='/customer/spending') Spending

    if customer
      .row.g-4
        .col-lg-8
          .mx-card.p-5
            h2.h5.fw-semibold.mb-4
              i.fas.fa-id-card.me-2
              | Personal information
            form(method='POST' action='/customer/profile')
              .row.g-3
                .col-md-6
                  label.form-label.fw-semibold(for='firstName') First name *
                  input.form-control.form-control-lg(type='text' id='firstName' name='firstName' value=customer.firstName || '' required maxlength='45')
                .col-md-6
                  label.form-label.fw-semibold(for='lastName') Last name *
                  input.form-control.form-control-lg(type='text' id='lastName' name='lastName' value=customer.lastName || '' required maxlength='45')
                .col-12
                  label.form-label.fw-semibold(for='email') Email address *
                  input.form-control.form-control-lg(type='email' id='email' name='email' value=customer.email || '' required maxlength='50')
                  .form-text.text-muted We'll send account alerts here.
              if customer.address
                .row.g-3.mt-1
                  .col-md-8
                    label.form-label.fw-semibold(for='address') Address
                    input.form-control.form-control-lg(type='text' id='address' name='address' value=customer.address || '' maxlength='50')
                    .form-text.text-muted Update only if your location changes.
                  .col-md-4
                    label.form-label.fw-semibold(for='phone') Phone number
                    input.form-control.form-control-lg(type='tel' id='phone' name='phone' value=customer.phone || '' maxlength='20')
                .row.g-3
                  .col-md-6
                    label.form-label.fw-semibold(for='postalCode') Postal code
                    input.form-control.form-control-lg(type='text' id='postalCode' name='postalCode' value=customer.postalCode || '' maxlength='10')
                  .col-md-6
                    label.form-label.fw-semibold City (read only)
                    input.form-control.form-control-lg(type='text' value=customer.city || '' readonly)
                    .form-text.text-muted Contact support to change your home store.
                .row.g-3
                  .col-12
                    label.form-label.fw-semibold Country (read only)
                    input.form-control.form-control-lg(type='text' value=customer.country || '' readonly)
              else
                .alert.alert-info.border-0.mt-3
                  i.fas.fa-info-circle.me-2
                  | Address details are not available for this profile yet.
              .d-flex.flex-wrap.gap-3.mt-4
                button.btn.btn-accent.btn-lg.rounded-pill(type='submit')
                  i.fas.fa-floppy-disk.me-2
                  | Save changes
                button.btn.btn-outline-light.btn-lg.rounded-pill(type='reset')
                  i.fas.fa-rotate-left.me-2
                  | Reset
        .col-lg-4
          .mx-card.p-4.mb-4
            h2.h6.text-uppercase.text-muted.mb-3 Account status
            .d-flex.align-items-start.gap-3
              if customer.active
                span.badge.bg-success.bg-opacity-25.text-success.px-3.py-2.rounded-pill
                  i.fas.fa-circle-check.me-2
                  | Active
              else
                span.badge.bg-danger.bg-opacity-25.text-danger.px-3.py-2.rounded-pill
                  i.fas.fa-circle-xmark.me-2
                  | Inactive
              div
                p.text-muted.small.mb-2 Keep your contact details current for uninterrupted access.
                p.text-muted.small.mb-0 Member since #{customer.createDate ? new Date(customer.createDate).toLocaleDateString() : 'N/A'}
                if customer.lastUpdate
                  p.text-muted.small.mb-0 Last updated #{new Date(customer.lastUpdate).toLocaleDateString()}
          if accountStats
            .mx-card.p-4
              h2.h6.text-uppercase.text-muted.mb-3 Quick stats
              .vstack.gap-3
                .d-flex.justify-content-between.align-items-center
                  span.d-flex.align-items-center.gap-2
                    i.fas.fa-film.text-danger
                    | Active rentals
                  span.badge.mx-pill.mx-pill-soft #{accountStats.activeRentals || 0}
                .d-flex.justify-content-between.align-items-center
                  span.d-flex.align-items-center.gap-2
                    i.fas.fa-sack-dollar.text-warning
                    | Total spent
                  span.fw-semibold $#{Number(accountStats.totalSpent || 0).toFixed(2)}
                .d-flex.justify-content-between.align-items-center
                  span.d-flex.align-items-center.gap-2
                    i.fas.fa-bag-shopping.text-info
                    | Total rentals
                  span.badge.mx-pill.mx-pill-soft #{accountStats.totalRentals || 0}
                if accountStats.overdueFees > 0
                  .d-flex.justify-content-between.align-items-center
                    span.d-flex.align-items-center.gap-2.text-warning
                      i.fas.fa-exclamation-triangle
                      | Outstanding fees
                    span.text-warning.fw-semibold $#{Number(accountStats.overdueFees).toFixed(2)}
    else
      .mx-card.p-5.text-center
        i.fas.fa-user-slash.fa-3x.text-muted.mb-3
        h2.h5.fw-semibold.mb-2 Profile not found
        p.text-muted.mb-4 We couldn’t load your details. Try again or reach out to support.
        .d-flex.justify-content-center.gap-3
          a.btn.btn-accent.rounded-pill.px-4(href='/customer/dashboard')
            i.fas.fa-gauge-high.me-2
            | Dashboard
          button.btn.btn-outline-light.rounded-pill.px-4(type='button' onclick='window.location.reload()')
            i.fas.fa-rotate-right.me-2
            | Retry

    section.mx-section.pt-0
      .mx-card.p-4
        h2.h6.text-uppercase.text-muted.mb-3 Account resources
        .row.g-3
          .col-sm-6.col-md-3
            a.btn.btn-outline-accent.w-100.rounded-pill.px-0(href='/customer/dashboard')
              i.fas.fa-gauge-high.me-2
              | Dashboard
          .col-sm-6.col-md-3
            a.btn.btn-outline-light.w-100.rounded-pill.px-0(href='/customer/spending')
              i.fas.fa-chart-line.me-2
              | Spending history
          .col-sm-6.col-md-3
            a.btn.btn-outline-light.w-100.rounded-pill.px-0(href='/films')
              i.fas.fa-film.me-2
              | Browse films
          .col-sm-6.col-md-3
            form(method='POST' action='/auth/logout')
              button.btn.btn-outline-danger.w-100.rounded-pill(type='submit')
                i.fas.fa-right-from-bracket.me-2
                | Logout

    section.mx-section.pt-0
      .mx-card.p-4
        .row.g-4
          .col-md-6
            h3.h6.text-uppercase.text-muted.mb-2
              i.fas.fa-shield-halved.me-2
              | Privacy & security
            p.text-muted.small Your information stays encrypted and is only used to power your rental experience. We never trade or sell personal data.
          .col-md-6
            h3.h6.text-uppercase.text-muted.mb-2
              i.fas.fa-circle-question.me-2
              | Need help?
            p.text-muted.small Contact support for account updates, store transfers, or billing assistance. We respond within one business day.
