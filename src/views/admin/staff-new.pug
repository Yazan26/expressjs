extends ../layout

block content
  .container.mt-4
    .row.justify-content-center
      .col-md-8.col-lg-6
        .card
          .card-header
            h2.h4.mb-0
              i.fas.fa-user-plus.me-2.text-success
              | Create New Staff Account
          
          .card-body
            // Error Messages
            if error && error.length > 0
              .alert.alert-danger.alert-dismissible.fade.show
                i.fas.fa-exclamation-triangle.me-2
                | #{error}
                button.btn-close(type="button", data-bs-dismiss="alert")

            form(method="POST", action="/admin/staff")
              .row.mb-3
                .col-md-6
                  label.form-label(for="first_name") First Name
                  input.form-control(
                    type="text", 
                    id="first_name", 
                    name="first_name", 
                    placeholder="pietje"
                    required
                  )
                .col-md-6
                  label.form-label(for="last_name") Last Name
                  input.form-control(
                    type="text", 
                    id="last_name", 
                    name="last_name", 
                    placeholder="puk"
                    required
                  )
              
              .mb-3
                label.form-label Email Address
                .input-group
                  input.form-control(
                    type="text", 
                    id="email_username", 
                    name="email_username", 
                    placeholder="example",
                    pattern="[a-zA-Z0-9._-]+",
                    required
                  )
                  span.input-group-text @
                  select.form-select(
                    id="email_domain", 
                    name="email_domain",
                    required
                  )
                    option(value="@moviesexpressrentals.com", selected) moviesexpressrentals.com
                    option(value="@avans.com") avans.com
                input.form-control(
                  type="hidden", 
                  id="email", 
                  name="email"
                )
                .form-text Enter the username part and select the domain. The email will be automatically combined.
              
              .mb-3
                label.form-label(for="username") Username
                input.form-control(
                  type="text", 
                  id="username", 
                  name="username", 
                  placeholder="pietjepuk",
                  pattern="[a-zA-Z0-9._-]+",
                  required
                )
                .form-text Used for login. Only letters, numbers, dots, underscores, and hyphens allowed.
              
              .mb-3
                label.form-label(for="password") Password
                input.form-control(
                  type="password", 
                  id="password", 
                  name="password", 
                  minlength="6",
                  required
                )
                .form-text Minimum 6 characters for security.
              
              .mb-3
                label.form-label(for="role") Role
                select.form-select(
                  id="role", 
                  name="role",
                  required
                )
                  option(value="staff", selected) Staff
                  option(value="admin") Admin
                .form-text 
                  | Staff members can handle rentals and basic operations. 
                  | Admins can manage staff accounts and system settings.
              
              .mb-3
                label.form-label(for="store_id") Store Assignment
                select.form-select(
                  id="store_id", 
                  name="store_id",
                  required
                )
                  option(value="1", selected) Store 1
                  option(value="2") Store 2
                .form-text Store location for this staff member.
              
              .d-flex.gap-2.justify-content-between
                a.btn.btn-outline-secondary(href="/admin/staff")
                  i.fas.fa-arrow-left.me-2
                  | Back to Staff List
                
                button.btn.btn-success(type="submit")
                  i.fas.fa-user-plus.me-2
                  | Create Staff Account

          .card-footer.text-muted.small
            i.fas.fa-info-circle.me-1
            | The new staff member will be created with basic access. Contact system admin for login credentials.

  script.
    document.addEventListener('DOMContentLoaded', function() {
      const usernameInput = document.getElementById('email_username');
      const domainSelect = document.getElementById('email_domain');
      const hiddenEmailInput = document.getElementById('email');
      
      function updateEmail() {
        const username = usernameInput.value.trim();
        const domain = domainSelect.value;
        if (username && domain) {
          hiddenEmailInput.value = username + domain;
        } else {
          hiddenEmailInput.value = '';
        }
      }
      
      // Update email on input changes
      usernameInput.addEventListener('input', updateEmail);
      domainSelect.addEventListener('change', updateEmail);
      
      // Update email on form submission to ensure it's current
      document.querySelector('form').addEventListener('submit', function(e) {
        updateEmail();
        
        // Validate that we have a complete email
        if (!hiddenEmailInput.value) {
          e.preventDefault();
          alert('Please enter a valid email address.');
          usernameInput.focus();
          return false;
        }
      });
      
      // Initial update in case fields are pre-filled
      updateEmail();
    });