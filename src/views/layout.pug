doctype html
html
  head
    link(rel="icon", type="image/x-icon", href="/favicon.ico")
    title= title || 'Movies Express Rentals'
    link(rel="stylesheet", href="/bootstrap/css/bootstrap.min.css")
    link(rel="stylesheet", href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css")
    script(src="/bootstrap/js/bootstrap.bundle.min.js")
    link(rel='stylesheet', href='/stylesheets/style.css')
    script(src='/javascripts/delete.user.js')
  body
    nav.navbar.navbar-expand-lg.bg-dark.border-bottom.border-body(data-bs-theme='dark')
      .container-fluid
        a.navbar-brand(href='/') 
          i.fas.fa-video.me-2
          | Movies Express Rentals
        button.navbar-toggler(type='button' data-bs-toggle='collapse' data-bs-target='#navbarSupportedContent' aria-controls='navbarSupportedContent' aria-expanded='false' aria-label='Toggle navigation')
          span.navbar-toggler-icon
        
        .collapse.navbar-collapse#navbarSupportedContent
          ul.navbar-nav.me-auto.mb-2.mb-lg-0
            li.nav-item
              a.nav-link(href='/' class=req && req.path === '/' ? 'active' : '') 
                i.fas.fa-home.me-1
                | Home
            
            li.nav-item
              a.nav-link(href='/films' class=req && req.path.includes('/films') ? 'active' : '')
                i.fas.fa-film.me-1
                | Films
            
            //- Show different navigation based on user role
            if authenticated && user
              if user.role === 'customer'
                li.nav-item
                  a.nav-link(href='/customer/dashboard' class=req && req.path.includes('/customer') ? 'active' : '')
                    i.fas.fa-tachometer-alt.me-1
                    | Customer Dashboard
              else if user.role === 'staff'
                li.nav-item.dropdown
                  a.nav-link.dropdown-toggle(href='#' role='button' data-bs-toggle='dropdown' aria-expanded='false' class=req && req.path.includes('/staff') ? 'active' : '')
                    i.fas.fa-user-tie.me-1
                    | Staff
                  ul.dropdown-menu
                    li
                      a.dropdown-item(href='/staff/dashboard')
                        i.fas.fa-tachometer-alt.me-1
                        | Dashboard
                    li
                      a.dropdown-item(href='/staff/offers')
                        i.fas.fa-tags.me-1
                        | Film Offers
                    li
                      a.dropdown-item(href='/staff/selections')
                        i.fas.fa-star.me-1
                        | My Selections
                    li
                      a.dropdown-item(href='/users')
                        i.fas.fa-users.me-1
                        | Users

              else if user.role === 'manager'
                li.nav-item.dropdown
                  a.nav-link.dropdown-toggle(href='#' role='button' data-bs-toggle='dropdown' aria-expanded='false' class=req && req.path.includes('/staff') ? 'active' : '')
                    i.fas.fa-user-tie.me-1
                    | Staff
                  ul.dropdown-menu
                    li
                      a.dropdown-item(href='/staff/dashboard')
                        i.fas.fa-tachometer-alt.me-1
                        | Dashboard
                    li
                      a.dropdown-item(href='/staff/offers')
                        i.fas.fa-tags.me-1
                        | Film Offers
                    li
                      a.dropdown-item(href='/staff/selections')
                        i.fas.fa-star.me-1
                        | My Selections
                li.nav-item
                  a.nav-link(href='/reports' class=req && req.path.includes('/reports') ? 'active' : '')
                    i.fas.fa-chart-bar.me-1
                    | Reports
              else if user.role === 'admin'
                li.nav-item.dropdown
                  a.nav-link.dropdown-toggle(href='#' role='button' data-bs-toggle='dropdown' aria-expanded='false' class=req && req.path.includes('/admin') ? 'active' : '')
                    i.fas.fa-user-shield.me-1
                    | Admin
                  ul.dropdown-menu
                    li
                      a.dropdown-item(href='/users')
                        i.fas.fa-users.me-1
                        | Users
                    li
                      a.dropdown-item(href='/admin/films')
                        i.fas.fa-film.me-1
                        | Films
                    li
                      a.dropdown-item(href='/admin/staff')
                        i.fas.fa-users.me-1
                        | Staff
                    li
                      a.dropdown-item(href='/admin/offers')
                        i.fas.fa-tags.me-1
                        | Offers
                li.nav-item
                  a.nav-link(href='/reports' class=req && req.path.includes('/reports') ? 'active' : '')
                    i.fas.fa-chart-bar.me-1
                    | Reports
              
              li.nav-item
                a.nav-link(href='/about' class=req && req.path === '/about' ? 'active' : '')
                  i.fas.fa-info-circle.me-1
                  | About
            else
              li.nav-item
                a.nav-link(href='/about' class=req && req.path === '/about' ? 'active' : '')
                  i.fas.fa-info-circle.me-1
                  | About
          
          //- Search form (always show)
          form.d-flex.me-3(role='search' action='/search' method='GET')
            input.form-control.me-2(type='search' name='q' placeholder='Search movies...' aria-label='Search')
            button.btn.btn-outline-light(type='submit')
              i.fas.fa-search
          
          //- User authentication section
          ul.navbar-nav
            if authenticated && user
              li.nav-item.dropdown
                a.nav-link.dropdown-toggle(href='#' role='button' data-bs-toggle='dropdown' aria-expanded='false')
                  i.fas.fa-user.me-1
                  | #{user.name || user.username}
                  span.badge.bg-secondary.ms-1= user.role
                ul.dropdown-menu.dropdown-menu-end
                  li
                    h6.dropdown-header
                      i.fas.fa-info-circle.me-1
                      | Account Info
                  li
                    span.dropdown-item-text
                      small Role: #{user.role}
                  li
                    hr.dropdown-divider
                  li
                    form(action='/auth/logout' method='POST' style='display: inline;')
                      button.dropdown-item(type='submit')
                        i.fas.fa-sign-out-alt.me-1
                        | Logout
            else
              li.nav-item
                a.nav-link(href='/auth/login')
                  i.fas.fa-sign-in-alt.me-1
                  | Login

    //- Main content area
    main.container-fluid.py-4
      block content

    //- Footer
    footer.bg-dark.text-light.py-4.mt-5
      .container
        .row
          .col-md-6
            h5
              i.fas.fa-video.me-2
              | Movies Express Rentals
            p.small Enterprise film rental management system with role-based access control.
          .col-md-6.text-md-end
            p.small
              | Â© 2024 Movies Express Rentals. Professional film rental management system.
            if authenticated && user
              p.small
                i.fas.fa-user-check.me-1
                | Logged in as: #{user.name || user.username} (#{user.role})
