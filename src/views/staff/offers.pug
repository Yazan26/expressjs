extends ../layout

block content
  .container-fluid
    .row.mb-4
      .col-8
        h1.h2.mb-1
          i.fas.fa-tags.me-2.text-warning
          | Staff Film Offers
        p.text-muted Select films offered by administration
      
      .col-4.text-end
        a.btn.btn-outline-info(href="/staff/selections") 
          i.fas.fa-star.me-2
          | My Selections

    // Filters
    .row.mb-4
      .col-12
        .card
          .card-body
            form.row.g-3(method="GET", action="/staff/offers")
              .col-md-6
                label.form-label Category
                select.form-select(name="category")
                  option(value="all", selected=currentCategory === 'all') All Categories
                  if categories
                    each category in categories
                      option(value=category.category_id, selected=currentCategory == category.category_id) #{category.name}
              
              .col-md-6.d-flex.align-items-end
                button.btn.btn-primary.w-100(type="submit")
                  i.fas.fa-search.me-2
                  | Filter

    // Offers List
    if offers && offers.length > 0
      .row
        each offer in offers
          .col-lg-4.col-md-6.mb-4
            .card.h-100
              .card-header
                h5.card-title.mb-1 #{offer.title}
                .small.text-muted #{offer.category_name} â€¢ #{offer.rating}
              
              .card-body
                if offer.description
                  p.card-text.small #{offer.description.substring(0, 100)}#{offer.description.length > 100 ? '...' : ''}
                
                .row.mb-3
                  .col-6
                    .small.text-muted Rental Rate
                    .fw-bold.text-success $#{parseFloat(offer.rental_rate).toFixed(2)}
                  .col-6
                    .small.text-muted Status
                    .badge.bg-success Available
                
                .d-flex.gap-2
                  button.btn.btn-success.btn-sm(onclick="selectOffer(#{offer.film_id})")
                    i.fas.fa-check.me-1
                    | Select
                  
                  a.btn.btn-outline-info.btn-sm(href="/films/#{offer.film_id}")
                    i.fas.fa-eye.me-1
                    | Details

      // Pagination
      if pagination && pagination.totalPages > 1
        .row.mt-4
          .col-12
            .d-flex.justify-content-center
              nav
                ul.pagination
                  if pagination.currentPage > 1
                    li.page-item
                      a.page-link(href="?page=#{pagination.currentPage - 1}&category=#{currentCategory}")
                        i.fas.fa-chevron-left
                  
                  - for (var i = 1; i <= pagination.totalPages; i++)
                    li.page-item(class=i === pagination.currentPage ? 'active' : '')
                      if i === pagination.currentPage
                        span.page-link #{i}
                      else
                        a.page-link(href="?page=#{i}&category=#{currentCategory}") #{i}
                  
                  if pagination.currentPage < pagination.totalPages
                    li.page-item
                      a.page-link(href="?page=#{pagination.currentPage + 1}&category=#{currentCategory}")
                        i.fas.fa-chevron-right

    else
      .row
        .col-12
          .card
            .card-body.text-center.py-5
              .mb-4
                i.fas.fa-tags.fa-4x.text-muted
              h4.text-muted No Offers Available
              p.text-muted No film offers are currently available.

script.
  function selectOffer(filmId) {
    // Simple JavaScript to handle offer selection
    if (confirm('Select this film offer?')) {
      fetch('/staff/offers/select', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          film_id: filmId
        })
      })
      .then(response => {
        if (response.ok) {
          alert('Offer selected successfully!');
          location.reload();
        } else {
          alert('Error selecting offer');
        }
      })
      .catch(() => alert('Error selecting offer'));
    }
  }