extends ../layout

block content
  .container-fluid
    // Page Header
    .row.mb-4
      .col-lg-8
        h1.h2.mb-1
          i.fas.fa-dollar-sign.me-2.text-success
          | Revenue Reports
        p.text-muted Track financial performance and revenue trends
      
      .col-lg-4.text-lg-end
        .btn-group
          a.btn.btn-outline-primary(href="/reports") 
            i.fas.fa-chart-bar.me-2
            | All Reports
          a.btn.btn-outline-info(href="/admin") 
            i.fas.fa-cog.me-2
            | Admin Panel

    // Summary Cards
    if summary
      .row.mb-4
        .col-md-4.mb-3
          .card.bg-success.bg-gradient.text-white
            .card-body.text-center
              .h3.mb-1 $#{summary.totalRevenue || 0}
              .small Total Revenue (12 Months)
        .col-md-4.mb-3
          .card.bg-info.bg-gradient.text-white
            .card-body.text-center
              .h3.mb-1 $#{summary.avgMonthly || 0}
              .small Average Monthly Revenue
        .col-md-4.mb-3
          .card.bg-warning.bg-gradient.text-white
            .card-body.text-center
              .h3.mb-1 #{summary.topMonth || 'N/A'}
              .small Best Performing Period

    // Filters
    .row.mb-4
      .col-12
        .card
          .card-header
            h5.card-title.mb-0
              i.fas.fa-filter.me-2
              | Report Filters
          .card-body
            form.row.g-3(method="GET", action="/reports/revenue")
              .col-md-4
                label.form-label Time Period
                select.form-select(name="period")
                  option(value="daily", selected=filters.period === 'daily') Daily
                  option(value="weekly", selected=filters.period === 'weekly') Weekly
                  option(value="monthly", selected=filters.period === 'monthly') Monthly
              
              .col-md-3
                label.form-label Start Date
                input.form-control(type="date", name="startDate", value=filters.startDate)
              
              .col-md-3
                label.form-label End Date
                input.form-control(type="date", name="endDate", value=filters.endDate)
              
              .col-md-2.d-flex.align-items-end
                button.btn.btn-primary.w-100(type="submit")
                  i.fas.fa-search.me-2
                  | Filter

    // Revenue Chart Area
    .row.mb-4
      .col-12
        .card
          .card-header
            h5.card-title.mb-0
              i.fas.fa-chart-line.me-2
              | Revenue Trend
          .card-body
            if revenue && revenue.length > 0
              // Simple visual representation of revenue trends
              .row.mb-3
                for period in revenue
                  .col-md-3.mb-2
                    .card.border-success.h-100
                      .card-body.text-center.py-2
                        .small.text-muted #{period.period}
                        .h6.text-success $#{parseFloat(period.total_revenue || 0).toFixed(2)}
                        .small.text-info #{period.transaction_count || 0} transactions
            else
              .text-center.py-4
                i.fas.fa-chart-line.fa-3x.text-muted
                p.text-muted.mt-2 No revenue data available for the selected period

    // Detailed Revenue Table
    if revenue && revenue.length > 0
      .row
        .col-12
          .card
            .card-header
              h5.card-title.mb-0
                i.fas.fa-table.me-2
                | Detailed Revenue Breakdown
            .card-body
              .table-responsive
                table.table.table-hover
                  thead.table-dark
                    tr
                      th Period
                      th Transactions
                      th Total Revenue
                      th Average Transaction
                      th Unique Customers
                      th Growth
                  tbody
                    for period, index in revenue
                      tr
                        td
                          strong #{period.period}
                        td.text-center #{period.transaction_count || 0}
                        td.text-success
                          strong $#{parseFloat(period.total_revenue || 0).toFixed(2)}
                        td.text-info $#{parseFloat(period.avg_transaction || 0).toFixed(2)}
                        td.text-center #{period.unique_customers || 0}
                        td
                          - var prevRevenue = index < revenue.length - 1 ? revenue[index + 1].total_revenue : period.total_revenue
                          - var growth = prevRevenue > 0 ? (((period.total_revenue - prevRevenue) / prevRevenue) * 100) : 0
                          if growth > 0
                            .badge.bg-success +#{growth.toFixed(1)}%
                          else if growth < 0
                            .badge.bg-danger #{growth.toFixed(1)}%
                          else
                            .badge.bg-secondary 0%
                  tfoot.table-light
                    tr
                      th Total
                      th.text-center #{revenue.reduce((sum, p) => sum + (p.transaction_count || 0), 0)}
                      th.text-success $#{revenue.reduce((sum, p) => sum + (p.total_revenue || 0), 0).toFixed(2)}
                      th.text-info $#{revenue.length > 0 ? (revenue.reduce((sum, p) => sum + (p.avg_transaction || 0), 0) / revenue.length).toFixed(2) : 0}
                      th.text-center #{revenue.reduce((sum, p) => sum + (p.unique_customers || 0), 0)}
                      th

    else
      .row
        .col-12
          .card
            .card-body.text-center.py-5
              .mb-4
                i.fas.fa-dollar-sign.fa-4x.text-muted
              h4.text-muted No Revenue Data
              p.text-muted No revenue data available for the selected criteria.

    // Quick Analytics
    .row.mt-4
      .col-md-6.mb-4
        .card.border-info
          .card-header.bg-info.text-white
            h6.card-title.mb-0
              i.fas.fa-lightbulb.me-2
              | Revenue Insights
          .card-body
            if revenue && revenue.length > 0
              - var totalRev = revenue.reduce((sum, p) => sum + (p.total_revenue || 0), 0)
              - var avgTrans = revenue.length > 0 ? (revenue.reduce((sum, p) => sum + (p.avg_transaction || 0), 0) / revenue.length) : 0
              - var bestPeriod = revenue.reduce((max, p) => (p.total_revenue || 0) > (max.total_revenue || 0) ? p : max, revenue[0])
              ul.list-unstyled.mb-0
                li.mb-2
                  i.fas.fa-check-circle.text-success.me-2
                  strong Best performing period: #{bestPeriod.period} ($#{parseFloat(bestPeriod.total_revenue || 0).toFixed(2)})
                li.mb-2
                  i.fas.fa-chart-line.text-info.me-2
                  | Average transaction value: $#{avgTrans.toFixed(2)}
                li.mb-2
                  i.fas.fa-users.text-primary.me-2
                  | Total unique customers served: #{revenue.reduce((sum, p) => sum + (p.unique_customers || 0), 0)}
            else
              p.text-muted No insights available without revenue data.

      .col-md-6.mb-4
        .card.border-warning
          .card-header.bg-warning.text-dark
            h6.card-title.mb-0
              i.fas.fa-download.me-2
              | Export Options
          .card-body
            p.card-text Download revenue reports for external analysis or sharing.
            .d-flex.flex-wrap.gap-2
              button.btn.btn-outline-success.btn-sm(onclick="exportReport('csv')")
                i.fas.fa-file-csv.me-1
                | Export CSV
              button.btn.btn-outline-danger.btn-sm(onclick="exportReport('pdf')")
                i.fas.fa-file-pdf.me-1
                | Export PDF
              button.btn.btn-outline-primary.btn-sm(onclick="exportReport('excel')")
                i.fas.fa-file-excel.me-1
                | Export Excel

script.
  function exportReport(format) {
    alert('Exporting revenue report in ' + format.toUpperCase() + ' format... (Feature coming soon)');
  }

style.
  .card
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075)
  .table th
    font-size: 0.875rem
    white-space: nowrap